{
  "title": "Interactive Story Definition",
  "description": "Schema for defining items, locations, transitions, and endings for the story engine.",
  "type": "object",
  "required": ["items", "locations", "endings"],
  "additionalProperties": false,
  "properties": {
    "items": {
      "$ref": "#/$defs/Items",
      "description": "All item definitions available in the story."
    },
    "locations": {
      "$ref": "#/$defs/Locations",
      "description": "All location definitions available in the story."
    },
    "endings": {
      "type": "array",
      "description": "Possible termination states of the story.",
      "items": { "$ref": "#/$defs/Ending" }
    }
  },
  "$defs": {
    "NonEmptyString": {
      "type": "string",
      "minLength": 1
    },
    "StringArray": {
      "type": "array",
      "items": { "$ref": "#/$defs/NonEmptyString" },
      "minItems": 1
    },
    "ActionList": {
      "type": "array",
      "description": "List of action verb identifiers that can trigger a transition (e.g. use, inspect).",
      "items": {
        "enum": ["use", "move", "examine", "take", "drop"]
      },
      "minItems": 1
    },
    "Items": {
      "type": "array",
      "items": { "$ref": "#/$defs/Item" }
    },
    "Locations": {
      "type": "array",
      "items": { "$ref": "#/$defs/Location" }
    },
    "ObjectSpecifier": {
      "type": "string",
      "description": "Identify an object by its name or name.state_index. If no state index is provided, object in any state will be matched.",
      "pattern": "^.+(\\.\\d+){0,1}"
    },
    "RequirementTuples": {
      "type": "array",
      "items": { "$ref": "#/$defs/ObjectSpecifier" },
      "minItems": 1
    },
    "Requirements": {
      "type": "object",
      "description": "Requirements that must be satisfied to perform a transition or reach an ending. Each field may be null (no constraint) or a specific constraint object.",
      "properties": {
        "inventory": {
          "description": "Met when the specified items are in the inventory.",
          "oneOf": [{ "type": "null" }, { "$ref": "#/$defs/RequirementTuples" }]
        },
        "items": {
          "description": "Met when the specified items in the world are in the given state.",
          "oneOf": [{ "type": "null" }, { "$ref": "#/$defs/RequirementTuples" }]
        },
        "locations": {
          "description": "Met when the specified locations in the world are in the given state.",
          "oneOf": [{ "type": "null" }, { "$ref": "#/$defs/RequirementTuples" }]
        },
        "turns": {
          "description": "Met when the number of turns is greater than specified amount.",
          "oneOf": [{ "type": "null" }, { "type": "number", "minimum": 1 }]
        },
        "current_location": {
          "description": "Met if current location is the specified one",
          "oneOf": [{ "type": "null" }, { "$ref": "#/$defs/ObjectSpecifier" }]
        }
      },
      "required": [
        "inventory",
        "items",
        "locations",
        "turns",
        "current_location"
      ],
      "additionalProperties": false
    },
    "Transition": {
      "type": "object",
      "description": "State change triggered by performing one of the listed actions when requirements are met.",
      "required": ["actions", "from", "to", "requirements"],
      "additionalProperties": false,
      "properties": {
        "actions": { "$ref": "#/$defs/ActionList" },
        "from": {
          "type": "integer",
          "minimum": 0,
          "description": "Index of the originating description/state."
        },
        "to": {
          "type": "integer",
          "minimum": 0,
          "description": "Index of the target description/state."
        },
        "requirements": { "$ref": "#/$defs/Requirements" }
      }
    },
    "Item": {
      "type": "object",
      "description": "Item definition with multiple description states and transitions.",
      "required": [
        "name",
        "type",
        "descriptions",
        "transitions",
        "collectible",
        "readable"
      ],
      "additionalProperties": false,
      "properties": {
        "name": { "$ref": "#/$defs/NonEmptyString" },
        "type": {
          "const": "item",
          "description": "Fixed discriminator to identify item objects."
        },
        "descriptions": {
          "type": "array",
          "description": "Ordered list of textual states for the item.",
          "items": { "$ref": "#/$defs/NonEmptyString" },
          "minItems": 1
        },
        "transitions": {
          "type": "array",
          "items": { "$ref": "#/$defs/Transition" },
          "description": "Possible state transitions for the item.",
          "default": []
        },
        "collectible": {
          "type": "boolean",
          "description": "True if the item can be added to the player's inventory"
        },
        "readable": {
          "type": "boolean",
          "description": "True if upon inspection the item reveals its descriptions verbatim"
        }
      }
    },
    "Location": {
      "type": "object",
      "description": "Location definition with possible transitions (e.g. lighting a room).",
      "required": [
        "name",
        "type",
        "descriptions",
        "transitions",
        "items",
        "exits"
      ],
      "additionalProperties": false,
      "properties": {
        "name": { "$ref": "#/$defs/NonEmptyString" },
        "type": {
          "const": "location",
          "description": "Fixed discriminator to identify location objects."
        },
        "descriptions": {
          "type": "array",
          "items": { "$ref": "#/$defs/NonEmptyString" },
          "minItems": 1
        },
        "transitions": {
          "type": "array",
          "items": { "$ref": "#/$defs/Transition" },
          "description": "Possible environmental state transitions for the location.",
          "default": []
        },
        "items": {
          "type": "array",
          "description": "Names of items initially present at this location.",
          "items": { "$ref": "#/$defs/NonEmptyString" },
          "default": []
        },
        "exits": {
          "type": "array",
          "description": "Names of other locations reachable from here.",
          "items": { "$ref": "#/$defs/NonEmptyString" },
          "default": []
        }
      }
    },
    "Ending": {
      "type": "object",
      "description": "Terminal game state reached when requirements are satisfied.",
      "required": ["state", "reason", "requirements"],
      "additionalProperties": false,
      "properties": {
        "state": {
          "type": "string",
          "enum": ["win", "lose"],
          "description": "Outcome classification."
        },
        "reason": { "$ref": "#/$defs/NonEmptyString" },
        "requirements": { "$ref": "#/$defs/Requirements" }
      }
    }
  }
}
